import{b as M,c as p,a as e,F,k as B,o as d,t as P,i as D,r as x,J as he,Q as Me,h as H,n as E,K as N,a0 as Ie,N as R,w as G,a1 as Oe,j as L,p as ce,L as ne,O as U,Z as Ae,_ as ee,f as J,x as _e,l as Z,a2 as Be,y as Ne,u as Ue}from"./index-C_y30its.js";import{B as ie}from"./Button-DNqQbY-G.js";import{F as V,c as Q,d as K,a as we,P as qe,S as ae,r as ue,b as me,g as ve,e as pe,h as X,i as ge,j as je,_ as $e,H as fe,k as be,l as ze,u as Ye,C as We}from"./DocumentPreviewModal.vue_vue_type_script_setup_true_lang-Dnwa0P9U.js";import{d as Xe,u as Ge,g as Je,s as Ze}from"./use-students-DMh6Nbth.js";import{c as Qe,f as Ke}from"./date-utils-t9SKoCgA.js";import{a as et}from"./company.constants-B4NxR415.js";const tt=async(i,c,t,a,n)=>{const{page:s}=c;let{currentY:o}=c;const r=a.left,_=o;n.forEach(h=>{s.drawText(h.text,{x:r,y:o,font:h.bold?i.timesRomanBold:i.timesRoman,size:V.invoiceInfo,color:i.colors.primary}),o-=14}),o=_;const I=a.right-150,T=a.right;t.forEach(h=>{const y=h.label,l=i.timesRomanBold.widthOfTextAtSize(y,V.invoiceInfo);s.drawText(y,{x:I-l,y:o,font:i.timesRomanBold,size:V.invoiceInfo,color:i.colors.primary});const v=h.value,u=i.timesRoman.widthOfTextAtSize(v,V.invoiceInfo);s.drawText(v,{x:T-u,y:o,size:V.invoiceInfo,font:i.timesRoman,color:i.colors.primary}),o-=14});const b=Math.min(o,_-n.length*14);return{...c,currentY:b}},ot=(i,c,t,a,n)=>(t.forEach(s=>{const o=n.right-200,r=n.right-100,_=Q(o,100,s[0],i.timesRomanBold,V.table),I=Q(r,100,s[1],i.timesRoman,V.table);K(c,s[0],_,a,i.timesRomanBold,V.table,i.colors.primary),K(c,s[1],I,a,i.timesRoman,V.table,i.colors.primary),we(c,n.right-200,n.right,a),a-=20}),a),st=(i,c,t,a)=>{let{startY:n}=t;const s=[n-10];if(t.headers){let o=a.left;t.headers.forEach((r,_)=>{const I=Q(o,t.columnWidths[_],r,i.timesRomanBold,V.table,_===0);K(c,r,I,n,i.timesRomanBold,V.table,i.colors.primary),o+=t.columnWidths[_]})}return n-=30,t.data.forEach(o=>{s.push(n);let r=a.left;o.forEach((_,I)=>{const T=Q(r,t.columnWidths[I],_,i.timesRoman,V.table,I===0);K(c,_,T,n,i.timesRoman,V.table,i.colors.primary),r+=t.columnWidths[I]}),n-=20}),s.forEach(o=>{we(c,a.left,a.right,o)}),n},nt=async(i,c,t,a)=>{const{page:n}=c;let{currentY:s}=c;const o={headers:["Description","Qty","Unit Price","Amount"],data:a.map(r=>[r.description,r.qty.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),`C$${r.unitPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,`C$${r.amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}`]),columnWidths:[302-t.left,50,100,100],startY:s};return s=st(i,n,o,t),{...c,currentY:s}};var it="M18,16V13H15V22H13V2H15V11H18V8L22,12L18,16M2,12L6,16V13H9V22H11V2H9V11H6V8L2,12Z",at="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",rt="M7,19V17H9V19H7M11,19V17H13V19H11M15,19V17H17V19H15M7,15V13H9V15H7M11,15V13H13V15H11M15,15V13H17V15H15M7,11V9H9V11H7M11,11V9H13V11H11M15,11V9H17V11H15M7,7V5H9V7H7M11,7V5H13V7H11M15,7V5H17V7H15Z",lt="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z",xe="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";const dt={class:"mb-6"},ct={class:"bg-blue-50 p-4 rounded-lg border"},ut={class:"space-y-2"},mt=["onClick"],vt={class:"flex justify-between items-center"},pt={viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400 group-hover:text-gray-600"},gt=["d"],ft=M({__name:"InvoicePresetItems",props:{presetItems:{}},emits:["add-preset-item"],setup(i,{emit:c}){const t=c;return(a,n)=>(d(),p("div",dt,[n[0]||(n[0]=e("h3",{class:"text-lg font-semibold mb-3"},"Preset Items",-1)),e("div",ct,[e("div",ut,[(d(!0),p(F,null,B(a.presetItems,(s,o)=>(d(),p("div",{key:o,class:"p-3 border rounded bg-white hover:bg-gray-50 cursor-pointer group",onClick:r=>t("add-preset-item",s)},[e("div",vt,[e("span",null,P(s.description)+" - C$"+P(s.unitPrice),1),(d(),p("svg",pt,[e("path",{d:D(xe)},null,8,gt)]))])],8,mt))),128))])])]))}}),Pe=async({invoiceData:i,programTitle:c,companyInfo:t,invoiceInfo:a,enrolmentDate:n,invoiceNumber:s})=>{if(!n)throw new Error("Enrolment date is required");const o=Qe(n),_=`${o.year}${o.month}${o.day}-????`,I=a.map($=>$.label==="Invoice #:"?{...$,value:s||_}:$),T=await qe.create(),b={pdfDoc:T,timesRoman:await T.embedFont(ae.TimesRoman),timesRomanBold:await T.embedFont(ae.TimesRomanBold),timesRomanItalic:await T.embedFont(ae.TimesRomanItalic),colors:{primary:ue(.07,.15,.5),secondary:ue(.07,.15,.5)}};let h=me(b),y=ve(h);const l=y.getMargin(je.invoice);await pe(b,y,l,X.Invoice),await ge(b,y,X.Invoice),y.currentY-=20,y=await tt(b,y,I,l,t),y.currentY-=40,h.drawText(c,{x:l.left,y:y.currentY,font:b.timesRomanBold,size:V.table,color:b.colors.primary}),y.currentY-=40,y=await nt(b,y,l,i),y.currentY<300?(h=me(b),y=ve(h),await pe(b,y,l,X.Invoice),await ge(b,y,X.Invoice),y.currentY-=60):y.currentY-=40;const v=i.reduce(($,C)=>$+C.amount,0),u=v,k=u,g=[["Subtotal",`C$${v.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`],["Total",`C$${u.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`],["Amount Paid",`C$${k.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`]];y.currentY=ot(b,h,g,y.currentY+10,l);const O=await T.save();return new Blob([O],{type:"application/pdf"})};function bt(){const i=x(!1),c=x(""),t=x(null),a=x(null),n=async r=>await Pe({invoiceData:r.invoice_items,programTitle:r.program_title,companyInfo:r.company_info,invoiceInfo:r.invoice_info,enrolmentDate:r.enrolment_date,invoiceNumber:r.invoice_number||""});return{storedInvoice:a,showPdfModal:i,pdfUrl:c,previewPdf:async r=>{try{t.value=await n(r),c.value=URL.createObjectURL(t.value),i.value=!0}catch(_){console.error("Failed to generate PDF:",_)}},downloadPdf:async()=>{var r;if(a.value)try{t.value=await n(a.value);const _=URL.createObjectURL(t.value),I=document.createElement("a");I.href=_,I.download=`Invoice-${((r=a.value)==null?void 0:r.invoice_number)||"unnamed"}.pdf`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(_)}catch(_){console.error("Failed to download PDF:",_)}}}}function yt(){const i=x(null),c=x(new Map),t=()=>{i.value=null};return{activeDropdownId:i,dropdownRefs:c,closeDropdown:t,toggleDropdown:(s,o)=>{o.stopPropagation(),i.value=i.value===s?null:s},handleClickOutside:s=>{if(i.value){const o=c.value.get(i.value);o&&!o.contains(s.target)&&t()}}}}const ht={key:0,class:"text-center py-8 text-gray-500"},It={key:1,class:"space-y-2 mb-10"},_t=["onClick"],wt={class:"flex justify-between items-center space-x-4"},$t={class:"font-medium"},xt={class:"text-sm text-gray-500"},Pt={class:"text-gray-700"},kt={class:"relative"},Tt=["onClick"],Dt=["onClick"],Vt=["onClick"],St=["onClick"],Ct=M({__name:"InvoiceHistory",props:{previousInvoices:{},selectedInvoice:{}},emits:["handle-invoice-select","refresh-invoices","reset-editor"],setup(i,{emit:c}){const t=c,{showPdfModal:a,pdfUrl:n,previewPdf:s,downloadPdf:o,storedInvoice:r}=bt(),{activeDropdownId:_,dropdownRefs:I,closeDropdown:T,toggleDropdown:b,handleClickOutside:h}=yt(),y=async(u,k)=>{if(k.stopPropagation(),confirm("Are you sure you want to delete this invoice?"))try{await Xe(u.id),t("refresh-invoices"),t("reset-editor"),R.success("Invoice deleted successfully")}catch(g){console.error("Failed to delete invoice:",g)}T()},l=async(u,k)=>{k.stopPropagation(),await s(u),T()},v=async(u,k)=>{k.stopPropagation(),r.value=u,await o(),T()};return he(()=>{document.addEventListener("click",h)}),Me(()=>{document.removeEventListener("click",h)}),(u,k)=>(d(),p(F,null,[k[2]||(k[2]=e("h2",{class:"text-xl font-bold mb-6"},"Previous Invoices",-1)),u.previousInvoices.length===0?(d(),p("div",ht," No previous invoices found ")):(d(),p("div",It,[(d(!0),p(F,null,B(u.previousInvoices,g=>{var O;return d(),p("div",{key:g.id,onClick:$=>t("handle-invoice-select",g),class:E(["p-4 border rounded cursor-pointer hover:bg-gray-50 transition-colors",{"border-blue-500 bg-blue-50":((O=u.selectedInvoice)==null?void 0:O.id)===g.id}])},[e("div",wt,[e("div",null,[e("div",$t,P(g.program_title),1),e("div",xt,P(new Date(g.created_at).toLocaleDateString()),1)]),e("div",Pt," C$"+P(g.invoice_items.reduce(($,C)=>$+C.amount,0).toFixed(2)),1),e("div",kt,[e("button",{onClick:$=>D(b)(g.id,$),class:"p-1 hover:bg-gray-100 rounded-full"},k[1]||(k[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)]),8,Tt),N(e("div",{ref_for:!0,ref:$=>{$&&D(I).set(g.id,$)},class:"absolute right-8 -top-2 mt-2 w-52 bg-white rounded-md shadow-lg py-1 z-10 border"},[e("button",{onClick:$=>l(g,$),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," Preview PDF ",8,Dt),e("button",{onClick:$=>v(g,$),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," Download PDF ",8,Vt),e("button",{onClick:$=>y(g,$),class:"block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 w-full text-left"}," Delete ",8,St)],512),[[Ie,D(_)===g.id]])])])],10,_t)}),128))])),H($e,{"is-open":D(a),"pdf-url":D(n),title:"Invoice",onClose:k[0]||(k[0]=g=>a.value=!1),onDownload:D(o)},null,8,["is-open","pdf-url","onDownload"])],64))}}),Ht={class:"mb-6"},Rt={class:"space-y-4"},Ft=["onDragstart","onDragover","onDrop"],Lt={key:0,class:"absolute w-full h-1 bg-blue-500 -top-1 z-10 animate-pulse"},Et={key:1,class:"absolute w-full h-1 bg-blue-500 -bottom-1 z-10 animate-pulse"},Mt=["onClick"],Ot={class:"flex-1 flex items-center"},At=["d"],Bt=["d"],Nt={key:0},Ut={key:1,class:"text-gray-400"},qt=["onClick"],jt={class:"p-4 border-t"},zt={class:"space-y-2"},Yt={class:"grid grid-cols-1 gap-4"},Wt={class:"w-full"},Xt=["onUpdate:modelValue"],Gt={class:"grid gap-4",style:{"grid-template-columns":"repeat(auto-fit, minmax(200px, 1fr))"}},Jt=["onUpdate:modelValue","onInput"],Zt=["onUpdate:modelValue","onInput"],Qt={class:"mt-1"},Kt=M({__name:"InvoiceItemsList",props:{invoiceItems:{},draggedItem:{},dropTarget:{},dropPosition:{},isItemOpen:{}},emits:["drag-start","drag-over","drag-leave","drop","toggle-item","remove-item","update-amount","add-item"],setup(i,{emit:c}){const t=c;return(a,n)=>(d(),p("div",Ht,[n[7]||(n[7]=e("h3",{class:"text-lg font-semibold mb-3"},"Invoice Items",-1)),e("div",Rt,[H(Oe,{name:"list",tag:"div",class:"space-y-4"},{default:G(()=>[(d(!0),p(F,null,B(a.invoiceItems,(s,o)=>(d(),p("div",{key:o,class:E(["border rounded relative transition-all duration-200",{"opacity-50 scale-[0.98] rotate-1":a.draggedItem===o,"drop-target shadow-lg":a.dropTarget===o}]),draggable:"true",onDragstart:r=>t("drag-start",o),onDragover:r=>t("drag-over",r,o),onDragleave:n[1]||(n[1]=r=>t("drag-leave")),onDrop:r=>t("drop",o)},[a.dropTarget===o&&a.dropPosition==="before"?(d(),p("div",Lt)):L("",!0),a.dropTarget===o&&a.dropPosition==="after"?(d(),p("div",Et)):L("",!0),e("div",{onClick:r=>t("toggle-item",o),class:"p-4 flex justify-between items-center cursor-pointer hover:bg-gray-50"},[e("div",Ot,[(d(),p("svg",{viewBox:"0 0 24 24",class:"w-5 h-5 mr-2 cursor-move text-gray-400 hover:text-gray-600",onClick:n[0]||(n[0]=ce(()=>{},["stop"]))},[e("path",{d:D(rt)},null,8,At)])),(d(),p("svg",{viewBox:"0 0 24 24",class:E(["w-5 h-5 mr-2 transition-transform duration-200",{"rotate-180":a.isItemOpen[o]}])},[e("path",{d:D(at)},null,8,Bt)],2)),s.description?(d(),p("span",Nt,P(s.description)+" - C$"+P(s.amount.toFixed(2)),1)):(d(),p("span",Ut," New Item "))]),e("button",{onClick:ce(r=>t("remove-item",o),["stop"]),class:"text-red-600 text-sm hover:text-red-800"}," Remove ",8,qt)],8,Mt),N(e("div",jt,[e("div",zt,[e("div",Yt,[e("div",Wt,[n[3]||(n[3]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),N(e("input",{"onUpdate:modelValue":r=>s.description=r,type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,8,Xt),[[ne,s.description]])]),e("div",Gt,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Qty",-1)),N(e("input",{"onUpdate:modelValue":r=>s.qty=r,type:"number",onInput:r=>t("update-amount",o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,40,Jt),[[ne,s.qty,void 0,{number:!0}]])]),e("div",null,[n[5]||(n[5]=e("label",{class:"block text-sm font-medium text-gray-700"},"Unit Price",-1)),N(e("input",{"onUpdate:modelValue":r=>s.unitPrice=r,type:"number",onInput:r=>t("update-amount",o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,40,Zt),[[ne,s.unitPrice,void 0,{number:!0}]])]),e("div",null,[n[6]||(n[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Amount",-1)),e("div",Qt,"C$"+P(s.amount.toFixed(2)),1)])])])])],512),[[Ie,!s.description||a.isItemOpen[o]]])],42,Ft))),128))]),_:1})]),e("button",{onClick:n[2]||(n[2]=s=>t("add-item")),class:"mt-4 text-blue-600"}," + Add Item ")]))}}),eo={class:"flex border-b"},to={viewBox:"0 0 24 24",class:"w-5 h-5"},oo=["d"],so={viewBox:"0 0 24 24",class:"w-5 h-5"},no=["d"],io={class:"p-6"},ao={key:0,class:"flex justify-center items-center py-12"},ro={key:1},lo={class:"mb-6"},co=["value"],uo={class:"mb-6"},mo={class:"space-y-2"},vo=["value"],po={class:"border-t pt-4"},go={class:"text-right"},fo={class:"text-lg font-semibold"},bo={key:2},yo=M({__name:"InvoicePanelLeft",props:{companyInfoText:{},programTitle:{},presetItems:{},invoiceItems:{},subtotal:{},isLoading:{type:Boolean},previousInvoices:{},selectedInvoice:{},activeTab:{},handleTabSwitch:{type:Function},addPresetItem:{type:Function},removeItem:{type:Function},updateAmount:{type:Function},handleInvoiceSelect:{type:Function},resetEditor:{type:Function}},emits:["update:companyInfoText","update:programTitle","update:invoiceItems","add-item","refresh-invoices"],setup(i,{emit:c}){const t=i,a=x({}),n=x(null),s=x(null),o=x(null),r=c,_=()=>{r("add-item",{description:"",qty:1,unitPrice:0,amount:0}),Ae(()=>{a.value[t.invoiceItems.length-1]=!0})},I=l=>{t.invoiceItems[l].description&&(a.value[l]=!a.value[l])},T=l=>{n.value=l},b=(l,v)=>{if(l.preventDefault(),n.value===null)return;const u=l.currentTarget.getBoundingClientRect(),k=u.top+u.height/2;s.value=v,o.value=l.clientY<k?"before":"after"},h=()=>{s.value=null,o.value=null},y=l=>{if(n.value===null)return;const v=[...t.invoiceItems],u=v[n.value];v.splice(n.value,1);const k=o.value==="after"?l+1:l;v.splice(k,0,u),r("update:invoiceItems",v),n.value=null,s.value=null,o.value=null};return(l,v)=>(d(),p(F,null,[e("div",eo,[e("button",{onClick:v[0]||(v[0]=u=>l.handleTabSwitch("editor")),class:E(["px-6 py-3 font-medium flex items-center gap-2",t.activeTab==="editor"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"])},[(d(),p("svg",to,[e("path",{d:D(xe)},null,8,oo)])),v[5]||(v[5]=U(" New Invoice "))],2),e("button",{onClick:v[1]||(v[1]=u=>l.handleTabSwitch("history")),class:E(["px-6 py-3 font-medium flex items-center gap-2",t.activeTab==="history"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"])},[(d(),p("svg",so,[e("path",{d:D(lt)},null,8,no)])),v[6]||(v[6]=U(" Invoice History "))],2)]),e("div",io,[l.isLoading?(d(),p("div",ao,v[7]||(v[7]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)]))):t.activeTab==="editor"?(d(),p("div",ro,[v[10]||(v[10]=e("h2",{class:"text-xl font-bold mb-6"},"Invoice Editor",-1)),e("div",lo,[v[8]||(v[8]=e("h3",{class:"text-lg font-semibold mb-3"},"Company Info",-1)),e("textarea",{value:l.companyInfoText,onInput:v[2]||(v[2]=u=>l.$emit("update:companyInfoText",u.target.value)),class:"w-full h-28 rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},"          ",40,co)]),e("div",uo,[v[9]||(v[9]=e("h3",{class:"text-lg font-semibold mb-3"},"Program Info",-1)),e("div",mo,[e("input",{value:l.programTitle,onInput:v[3]||(v[3]=u=>l.$emit("update:programTitle",u.target.value)),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,40,vo)])]),H(ft,{"preset-items":l.presetItems,onAddPresetItem:l.addPresetItem},null,8,["preset-items","onAddPresetItem"]),H(Kt,{"invoice-items":l.invoiceItems,"dragged-item":n.value,"drop-target":s.value,"drop-position":o.value,"is-item-open":a.value,onDragStart:T,onDragOver:b,onDragLeave:h,onDrop:y,onToggleItem:I,onRemoveItem:l.removeItem,onUpdateAmount:l.updateAmount,onAddItem:_},null,8,["invoice-items","dragged-item","drop-target","drop-position","is-item-open","onRemoveItem","onUpdateAmount"]),e("div",po,[e("div",go,[e("div",fo," Subtotal: C$"+P(l.subtotal.toFixed(2)),1)])])])):t.activeTab==="history"?(d(),p("div",bo,[H(Ct,{"previous-invoices":l.previousInvoices,"selected-invoice":l.selectedInvoice,onHandleInvoiceSelect:l.handleInvoiceSelect,onRefreshInvoices:v[4]||(v[4]=u=>l.$emit("refresh-invoices")),onResetEditor:l.resetEditor},null,8,["previous-invoices","selected-invoice","onHandleInvoiceSelect","onResetEditor"])])):L("",!0)])],64))}}),ho=ee(yo,[["__scopeId","data-v-cae66960"]]),Io={class:"preview-container p-8 bg-white shadow-lg"},_o=["src","alt"],wo={class:"w-full mb-8"},$o={class:"w-full"},xo={class:"text-right font-bold"},Po={class:"mb-6"},ko={class:"font-bold text-primary"},To={class:"w-full mb-8"},Do={class:"py-2"},Vo={class:"text-right py-2"},So={class:"text-right py-2"},Co={class:"text-right py-2"},Ho={class:"w-1/2 ml-auto"},Ro={class:"flex justify-between border-b py-2"},Fo={class:"w-1/2 text-right"},Lo={class:"flex justify-between border-b py-2"},Eo={class:"w-1/2 text-right"},Mo={class:"flex justify-between border-b py-2"},Oo={class:"w-1/2 text-right"},Ao=["src","alt"],Bo={class:"text-center"},No=M({__name:"PreviewWindow",props:{student:{},subtotal:{},invoiceItems:{},companyInfo:{},programTitle:{},invoiceInfo:{}},setup(i){const c=i,t=J(()=>c.subtotal),a=n=>`C$${n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return(n,s)=>(d(),p("div",Io,[e("img",{src:D(fe).src,alt:D(fe).alt,class:"w-1/2 mb-8"},null,8,_o),s[4]||(s[4]=e("div",{class:"text-center mb-12"},[e("h1",{class:"text-2xl font-bold text-primary text-right"},"INVOICE")],-1)),e("table",wo,[e("tbody",null,[e("tr",null,[e("td",null,[(d(!0),p(F,null,B(n.companyInfo,o=>(d(),p("p",{key:o.text,class:E({"font-bold":o.bold})},P(o.text),3))),128))]),e("td",null,[e("table",$o,[e("tbody",null,[(d(!0),p(F,null,B(n.invoiceInfo,(o,r)=>(d(),p("tr",{key:o.label},[e("td",xo,P(o.label),1),e("td",{class:E(["text-right",{italic:r===0}])},P(o.value),3)]))),128))])])])])])]),s[5]||(s[5]=e("div",{class:"h-16"},null,-1)),e("div",Po,[e("h3",ko,P(n.programTitle),1)]),s[6]||(s[6]=e("div",{class:"h-6"},null,-1)),e("table",To,[s[0]||(s[0]=e("thead",null,[e("tr",{class:"border-b"},[e("th",{class:"text-left py-2"},"Description"),e("th",{class:"text-right py-2"},"Qty"),e("th",{class:"text-right py-2 w-1/4"},"Unit Price"),e("th",{class:"text-right py-2 w-1/4"},"Amount")])],-1)),e("tbody",null,[(d(!0),p(F,null,B(n.invoiceItems,o=>(d(),p("tr",{key:o.description,class:"border-b"},[e("td",Do,P(o.description),1),e("td",Vo,P(o.qty),1),e("td",So,P(a(o.unitPrice)),1),e("td",Co,P(a(o.amount)),1)]))),128))])]),e("div",Ho,[e("div",Ro,[s[1]||(s[1]=e("span",{class:"w-1/2 text-right font-bold"},"Subtotal:",-1)),e("span",Fo,P(a(t.value)),1)]),e("div",Lo,[s[2]||(s[2]=e("span",{class:"w-1/2 text-right font-bold"},"Total:",-1)),e("span",Eo,P(a(t.value)),1)]),e("div",Mo,[s[3]||(s[3]=e("span",{class:"w-1/2 text-right font-bold"},"Amount Paid:",-1)),e("span",Oo,P(a(t.value)),1)])]),s[7]||(s[7]=e("div",{class:"h-16"},null,-1)),e("img",{src:D(be).src,alt:D(be).alt,class:"w-14 mx-auto mt-8"},null,8,Ao),e("p",Bo,P(D(ze)[0]),1)]))}}),ye=ee(No,[["__scopeId","data-v-38890b25"]]),Uo={id:"rightSide",class:"bg-white p-6 rounded-lg shadow h-full"},qo={key:0},jo={key:1,class:"flex items-center justify-center h-full"},zo={key:0},Yo={key:1,class:"text-gray-500 italic bg-gray-100 p-4 rounded-lg"},Wo={key:2,class:"text-gray-500 italic bg-gray-100 p-4 rounded-lg"},Xo=M({__name:"InvoicePanelRight",props:{student:{},subtotal:{},invoiceItems:{},companyInfo:{},invoiceInfo:{},programTitle:{},activeTab:{},previousInvoices:{},selectedInvoice:{}},setup(i){const c=i;return _e(()=>[c.invoiceItems,c.companyInfo,c.programTitle],()=>{}),(t,a)=>(d(),p("div",Uo,[t.activeTab==="editor"?(d(),p("div",qo,[t.student?(d(),Z(ye,{key:0,student:t.student,subtotal:t.subtotal,"invoice-items":t.invoiceItems,"company-info":t.companyInfo,"invoice-info":t.invoiceInfo,"program-title":t.programTitle},null,8,["student","subtotal","invoice-items","company-info","invoice-info","program-title"])):L("",!0)])):t.activeTab==="history"?(d(),p("div",jo,[t.selectedInvoice?(d(),p("div",zo,[t.student?(d(),Z(ye,{key:0,student:t.student,subtotal:t.subtotal,"invoice-items":t.invoiceItems,"company-info":t.companyInfo,"invoice-info":t.invoiceInfo,"program-title":t.programTitle},null,8,["student","subtotal","invoice-items","company-info","invoice-info","program-title"])):L("",!0)])):t.previousInvoices.length===0?(d(),p("p",Yo," No invoice history available ")):(d(),p("p",Wo," Select an invoice from history to preview "))])):L("",!0)]))}}),Go=ee(Xo,[["__scopeId","data-v-88eb9408"]]),Jo=[{description:"Registration Fee (Non-refundable)",qty:1,unitPrice:150,amount:150},{description:"Tuition Fee including Scholarship (Non-refundable)",qty:1,unitPrice:2850,amount:2850}],Zo=[{id:"invoice_number",label:"Invoice #:",getValue:({invoice:i})=>(i==null?void 0:i.invoice_number)||"Generated on Save"},{id:"bill_to",label:"Bill to:",getValue:({student:i})=>(i==null?void 0:i.display_name)||"N/A"},{id:"email",label:"Email:",getValue:({student:i})=>(i==null?void 0:i.user_email)||"N/A"},{id:"date_paid",label:"Date Paid:",getValue:({datePaid:i})=>i||"N/A"},{id:"payment_method",label:"Payment Method:",getValue:()=>"Agent",defaultValue:"Agent"}],Qo={class:"flex flex-col"},Ko={class:"mb-6 flex justify-between items-center"},es={class:"space-x-4 flex items-center"},ts={class:"flex flex-row"},os={id:"leftSide",class:"bg-white rounded-lg shadow",style:{width:"50%"}},ss={viewBox:"0 0 24 24",class:"icon"},ns=["d"],is={id:"rightSide",class:"bg-white rounded-lg shadow",style:{width:"calc(50% - 10px)"}},as=M({__name:"InvoiceEditor",async setup(i){var le;let c,t;const a=Ne(),n=Ue(),{getStudentById:s}=Ge(),{student:o,pdfUrl:r,pdfTitle:_}=Ye(),I=x(!1),T=x(!1),b=x(([c,t]=Be(()=>s(parseInt(a.params.id,10))),c=await c,t(),c));o.value=b.value;const h=x(et),y=J({get:()=>h.value.map(f=>f.text).join(`
`),set:f=>{h.value=f.split(`
`).map(m=>({text:m,bold:!1}))}}),l=parseInt(a.query.course_id,10),v=x(a.query.mode),u=x(""),k=()=>{const f=We.find(m=>m.id===l);f?u.value=`${f.title}`:u.value=`${l}`},g=x([]),O=x(Jo),$=x([]),C=x(null),te=J(()=>g.value.reduce((f,m)=>f+m.amount,0)),ke=Ke(((le=b.value)==null?void 0:le.enrollment_date)||""),oe=J(()=>Zo.map(f=>({label:f.label,value:f.getValue({invoice:C.value,student:b.value,datePaid:ke})}))),q=x({invoiceItems:[],companyInfo:h.value,programTitle:u.value}),A=x(v.value),j=async()=>{var f;if(b.value){const m=await Pe({invoiceData:g.value,programTitle:u.value,companyInfo:h.value,invoiceInfo:oe.value,enrolmentDate:b.value.enrollment_date,invoiceNumber:((f=C.value)==null?void 0:f.invoice_number)||""});_.value="Invoice",r.value=URL.createObjectURL(m)}},se=async()=>{var f;if((f=b.value)!=null&&f.ID)try{I.value=!0;const m=await Je(b.value.ID);$.value=m.map(w=>({...w,updated_at:w.created_at,invoice_items:Array.isArray(w.invoice_items)?w.invoice_items:JSON.parse(w.invoice_items),company_info:Array.isArray(w.company_info)?w.company_info:JSON.parse(w.company_info),invoice_info:Array.isArray(w.invoice_info)?w.invoice_info:JSON.parse(w.invoice_info)}))}catch(m){console.error("Failed to fetch previous invoices:",m)}finally{I.value=!1}},Te=async f=>{try{I.value=!0,C.value=f,h.value=f.company_info,g.value=f.invoice_items,u.value=f.program_title,await j()}catch(m){console.error("Failed to load invoice:",m)}finally{I.value=!1}},re=()=>{C.value=null,g.value=[],j()},De=f=>{f==="editor"?(re(),A.value="editor",g.value=q.value.invoiceItems,h.value=q.value.companyInfo,u.value=q.value.programTitle):(A.value="history",q.value={invoiceItems:[...g.value],companyInfo:[...h.value],programTitle:u.value},g.value=[],se()),n.replace({query:{...a.query,mode:f}})},Ve=f=>{g.value.push({...f})},Se=()=>{g.value.push({description:"",qty:1,unitPrice:0,amount:0})},Ce=f=>{g.value.splice(f,1)},He=f=>{const m=g.value[f];m.amount=m.qty*m.unitPrice},Re=async()=>{T.value=!0},Fe=async()=>{var m,w,z,Y;if(!((m=b.value)!=null&&m.ID)){R.error("Student ID is required");return}if(!((w=b.value)!=null&&w.enrollment_date)){R.error("Enrolment date is required");return}if(g.value.length===0){R.error("Please add at least one invoice item");return}if(h.value.length===0||h.value.every(S=>!S.text.trim())){R.error("Company information cannot be empty");return}if(!u.value.trim()){R.error("Program title cannot be empty");return}if(g.value.some(S=>!S.description.trim()||S.qty<=0||S.unitPrice<=0)){R.error("All invoice items must have a description, quantity, and price greater than 0");return}try{const S={student_id:(z=b.value)==null?void 0:z.ID,program_title:u.value,company_info:JSON.stringify(h.value),invoice_info:JSON.stringify(oe.value),invoice_items:JSON.stringify(g.value),enrolment_date:(Y=b.value)==null?void 0:Y.enrollment_date};await Ze(S),R.success("Invoice saved successfully")}catch(S){console.error("Failed to save invoice:",S)}},Le=f=>{const m=document.getElementById("leftSide"),w=document.getElementById("rightSide"),z=f.clientX,Y=m.offsetWidth,S=Ee=>{const W=Y+(Ee.clientX-z);W>100&&W<window.innerWidth-100&&(m.style.width=`${W}px`,w.style.width=`calc(100% - ${W}px - 10px)`)},de=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",de)};document.addEventListener("mousemove",S),document.addEventListener("mouseup",de)};return _e([g,b,u,te],j,{deep:!0}),he(()=>{k(),j(),se()}),(f,m)=>(d(),p("div",Qo,[e("div",Ko,[H(ie,{showIcon:"return",iconPosition:"left",onClick:m[0]||(m[0]=w=>D(n).back()),buttonClass:"bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow flex items-center transition duration-300 ease-in-out"},{default:G(()=>m[5]||(m[5]=[U(" Return ")])),_:1}),e("div",es,[A.value==="editor"?(d(),Z(ie,{key:0,showIcon:"magnify",onClick:Re,buttonClass:"bg-blue-100 hover:bg-blue-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow flex items-center transition duration-300 ease-in-out"},{default:G(()=>m[6]||(m[6]=[U(" Preview PDF ")])),_:1})):L("",!0),A.value==="editor"?(d(),Z(ie,{key:1,showIcon:"save",onClick:Fe,buttonClass:"bg-green-100 hover:bg-green-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow flex items-center transition duration-300 ease-in-out"},{default:G(()=>m[7]||(m[7]=[U(" Save ")])),_:1})):L("",!0)])]),e("div",ts,[e("div",os,[H(ho,{"company-info-text":y.value,"onUpdate:companyInfoText":m[1]||(m[1]=w=>y.value=w),"program-title":u.value,"onUpdate:programTitle":m[2]||(m[2]=w=>u.value=w),"invoice-items":g.value,"onUpdate:invoiceItems":m[3]||(m[3]=w=>g.value=w),"preset-items":O.value,subtotal:te.value,"is-loading":I.value,"previous-invoices":$.value,"selected-invoice":C.value,"active-tab":A.value,"handle-tab-switch":De,"add-preset-item":Ve,"remove-item":Ce,"update-amount":He,"handle-invoice-select":Te,"reset-editor":re,onAddItem:Se,onRefreshInvoices:se},null,8,["company-info-text","program-title","invoice-items","preset-items","subtotal","is-loading","previous-invoices","selected-invoice","active-tab"])]),e("div",{class:"resize-handler flex items-center justify-center",onMousedown:Le},[(d(),p("svg",ss,[e("path",{d:D(it)},null,8,ns)]))],32),e("div",is,[H(Go,{student:b.value,subtotal:te.value,"invoice-items":g.value,"company-info":h.value,"invoice-info":oe.value,"program-title":u.value,"active-tab":A.value,"previous-invoices":$.value,"selected-invoice":C.value},null,8,["student","subtotal","invoice-items","company-info","invoice-info","program-title","active-tab","previous-invoices","selected-invoice"])])]),H($e,{"is-open":T.value,"pdf-url":D(r),title:"Invoice",onClose:m[4]||(m[4]=w=>T.value=!1)},null,8,["is-open","pdf-url"])]))}}),vs=ee(as,[["__scopeId","data-v-4fef4737"]]);export{vs as default};
