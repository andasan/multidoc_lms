import{b as M,c as v,a as e,F as L,j as N,o as c,t as T,h as p,r as $,J as be,Q as Ee,p as F,n as E,K as B,a0 as ye,N as R,w as Y,a1 as Me,i as H,m as le,L as ee,O as U,Z as Ae,_ as Z,f as W,x as he,k as X,a2 as Ne,U as te,y as Oe,u as Be}from"./index-Drlqlh6G.js";import{B as oe}from"./Button-DGrdawDR.js";import{F as S,c as G,d as J,a as Ie,P as Ue,S as se,r as de,b as ce,g as ue,e as me,h as z,i as ve,j as qe,_ as _e,H as pe,k as ge,l as je,C as ze,u as Ye}from"./DocumentPreviewModal.vue_vue_type_script_setup_true_lang-Bbwt5Qg2.js";import{d as We,s as Xe,u as Ge,g as Je}from"./use-students-DkgNrbWc.js";import{c as Ze,f as Qe}from"./date-utils-t9SKoCgA.js";import{b as Ke}from"./company.constants-Bxe_fzZy.js";import"./logo-C5CzYpGe.js";const et=async(i,u,t,a,o)=>{const{page:n}=u;let{currentY:s}=u;const r=a.left,_=s;o.forEach(w=>{n.drawText(w.text,{x:r,y:s,font:w.bold?i.timesRomanBold:i.timesRoman,size:S.invoiceInfo,color:i.colors.primary}),s-=14}),s=_;const h=a.right-150,k=a.right;t.forEach(w=>{const g=w.label,d=i.timesRomanBold.widthOfTextAtSize(g,S.invoiceInfo);n.drawText(g,{x:h-d,y:s,font:i.timesRomanBold,size:S.invoiceInfo,color:i.colors.primary});const m=w.value,f=i.timesRoman.widthOfTextAtSize(m,S.invoiceInfo);n.drawText(m,{x:k-f,y:s,size:S.invoiceInfo,font:i.timesRoman,color:i.colors.primary}),s-=14});const I=Math.min(s,_-o.length*14);return{...u,currentY:I}},tt=(i,u,t,a,o)=>(t.forEach(n=>{const s=o.right-200,r=o.right-100,_=G(s,100,n[0],i.timesRomanBold,S.table),h=G(r,100,n[1],i.timesRoman,S.table);J(u,n[0],_,a,i.timesRomanBold,S.table,i.colors.primary),J(u,n[1],h,a,i.timesRoman,S.table,i.colors.primary),Ie(u,o.right-200,o.right,a),a-=20}),a),ot=(i,u,t,a)=>{let{startY:o}=t;const n=[o-10];if(t.headers){let s=a.left;t.headers.forEach((r,_)=>{const h=G(s,t.columnWidths[_],r,i.timesRomanBold,S.table,_===0);J(u,r,h,o,i.timesRomanBold,S.table,i.colors.primary),s+=t.columnWidths[_]})}return o-=30,t.data.forEach(s=>{n.push(o);let r=a.left;s.forEach((_,h)=>{const k=G(r,t.columnWidths[h],_,i.timesRoman,S.table,h===0);J(u,_,k,o,i.timesRoman,S.table,i.colors.primary),r+=t.columnWidths[h]}),o-=20}),n.forEach(s=>{Ie(u,a.left,a.right,s)}),o},st=async(i,u,t,a)=>{const{page:o}=u;let{currentY:n}=u;const s={headers:["Description","Qty","Unit Price","Amount"],data:a.map(r=>[r.description,r.qty.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),`C$${r.unitPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,`C$${r.amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}`]),columnWidths:[302-t.left,50,100,100],startY:n};return n=ot(i,o,s,t),{...u,currentY:n}};var nt="M18,16V13H15V22H13V2H15V11H18V8L22,12L18,16M2,12L6,16V13H9V22H11V2H9V11H6V8L2,12Z",it="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",at="M7,19V17H9V19H7M11,19V17H13V19H11M15,19V17H17V19H15M7,15V13H9V15H7M11,15V13H13V15H11M15,15V13H17V15H15M7,11V9H9V11H7M11,11V9H13V11H11M15,11V9H17V11H15M7,7V5H9V7H7M11,7V5H13V7H11M15,7V5H17V7H15Z",rt="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z",we="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";const lt={class:"mb-6"},dt={class:"bg-blue-50 p-4 rounded-lg border"},ct={class:"space-y-2"},ut=["onClick"],mt={class:"flex justify-between items-center"},vt={viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400 group-hover:text-gray-600"},pt=["d"],gt=M({__name:"InvoicePresetItems",props:{presetItems:{}},emits:["add-preset-item"],setup(i,{emit:u}){const t=u;return(a,o)=>(c(),v("div",lt,[o[0]||(o[0]=e("h3",{class:"text-lg font-semibold mb-3"},"Preset Items",-1)),e("div",dt,[e("div",ct,[(c(!0),v(L,null,N(a.presetItems,(n,s)=>(c(),v("div",{key:s,class:"p-3 border rounded bg-white hover:bg-gray-50 cursor-pointer group",onClick:r=>t("add-preset-item",n)},[e("div",mt,[e("span",null,T(n.description)+" - C$"+T(n.unitPrice),1),(c(),v("svg",vt,[e("path",{d:p(we)},null,8,pt)]))])],8,ut))),128))])])]))}}),$e=async({invoiceData:i,programTitle:u,companyInfo:t,invoiceInfo:a,enrolmentDate:o,invoiceNumber:n})=>{if(!o)throw new Error("Enrolment date is required");const s=Ze(o),_=`${s.year}${s.month}${s.day}-????`,h=a.map(x=>x.label==="Invoice #:"?{...x,value:n||_}:x),k=await Ue.create(),I={pdfDoc:k,timesRoman:await k.embedFont(se.TimesRoman),timesRomanBold:await k.embedFont(se.TimesRomanBold),timesRomanItalic:await k.embedFont(se.TimesRomanItalic),colors:{primary:de(.07,.15,.5),secondary:de(.07,.15,.5)}};let w=ce(I),g=ue(w);const d=g.getMargin(qe.invoice);await me(I,g,d,z.Invoice),await ve(I,g,z.Invoice),g.currentY-=20,g=await et(I,g,h,d,t),g.currentY-=40,w.drawText(u,{x:d.left,y:g.currentY,font:I.timesRomanBold,size:S.table,color:I.colors.primary}),g.currentY-=40,g=await st(I,g,d,i),g.currentY<300?(w=ce(I),g=ue(w),await me(I,g,d,z.Invoice),await ve(I,g,z.Invoice),g.currentY-=60):g.currentY-=40;const m=i.reduce((x,O)=>x+O.amount,0),f=m,l=f,b=[["Subtotal",`C$${m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`],["Total",`C$${f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`],["Amount Paid",`C$${l.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`]];g.currentY=tt(I,w,b,g.currentY+10,d);const V=await k.save();return new Blob([V],{type:"application/pdf"})};function ft(){const i=$(!1),u=$(""),t=$(null),a=$(null),o=async r=>await $e({invoiceData:r.invoice_items,programTitle:r.program_title,companyInfo:r.company_info,invoiceInfo:r.invoice_info,enrolmentDate:r.enrolment_date,invoiceNumber:r.invoice_number||""});return{storedInvoice:a,showPdfModal:i,pdfUrl:u,previewPdf:async r=>{try{t.value=await o(r),u.value=URL.createObjectURL(t.value),i.value=!0}catch(_){console.error("Failed to generate PDF:",_)}},downloadPdf:async()=>{var r;if(a.value)try{t.value=await o(a.value);const _=URL.createObjectURL(t.value),h=document.createElement("a");h.href=_,h.download=`Invoice-${((r=a.value)==null?void 0:r.invoice_number)||"unnamed"}.pdf`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(_)}catch(_){console.error("Failed to download PDF:",_)}}}}function bt(){const i=$(null),u=$(new Map),t=()=>{i.value=null};return{activeDropdownId:i,dropdownRefs:u,closeDropdown:t,toggleDropdown:(n,s)=>{s.stopPropagation(),i.value=i.value===n?null:n},handleClickOutside:n=>{if(i.value){const s=u.value.get(i.value);s&&!s.contains(n.target)&&t()}}}}const yt={key:0,class:"text-center py-8 text-gray-500"},ht={key:1,class:"space-y-2 mb-10"},It=["onClick"],_t={class:"flex justify-between items-center space-x-4"},wt={class:"font-medium"},$t={class:"text-sm text-gray-500"},xt={class:"text-gray-700"},Pt={class:"relative"},Tt=["onClick"],kt=["onClick"],Dt=["onClick"],Vt=["onClick"],St=M({__name:"InvoiceHistory",props:{previousInvoices:{},selectedInvoice:{}},emits:["handle-invoice-select","refresh-invoices","reset-editor"],setup(i,{emit:u}){const t=u,{showPdfModal:a,pdfUrl:o,previewPdf:n,downloadPdf:s,storedInvoice:r}=ft(),{activeDropdownId:_,dropdownRefs:h,closeDropdown:k,toggleDropdown:I,handleClickOutside:w}=bt(),g=async(f,l)=>{if(l.stopPropagation(),confirm("Are you sure you want to delete this invoice?"))try{await We(f.id),t("refresh-invoices"),t("reset-editor"),R.success("Invoice deleted successfully")}catch(b){console.error("Failed to delete invoice:",b)}k()},d=async(f,l)=>{l.stopPropagation(),await n(f),k()},m=async(f,l)=>{l.stopPropagation(),r.value=f,await s(),k()};return be(()=>{document.addEventListener("click",w)}),Ee(()=>{document.removeEventListener("click",w)}),(f,l)=>(c(),v(L,null,[l[2]||(l[2]=e("h2",{class:"text-xl font-bold mb-6"},"Previous Invoices",-1)),f.previousInvoices.length===0?(c(),v("div",yt," No previous invoices found ")):(c(),v("div",ht,[(c(!0),v(L,null,N(f.previousInvoices,b=>{var V;return c(),v("div",{key:b.id,onClick:x=>t("handle-invoice-select",b),class:E(["p-4 border rounded cursor-pointer hover:bg-gray-50 transition-colors",{"border-blue-500 bg-blue-50":((V=f.selectedInvoice)==null?void 0:V.id)===b.id}])},[e("div",_t,[e("div",null,[e("div",wt,T(b.program_title),1),e("div",$t,T(new Date(b.created_at).toLocaleDateString()),1)]),e("div",xt," C$"+T(b.invoice_items.reduce((x,O)=>x+O.amount,0).toFixed(2)),1),e("div",Pt,[e("button",{onClick:x=>p(I)(b.id,x),class:"p-1 hover:bg-gray-100 rounded-full"},l[1]||(l[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)]),8,Tt),B(e("div",{ref_for:!0,ref:x=>{x&&p(h).set(b.id,x)},class:"absolute right-8 -top-2 mt-2 w-52 bg-white rounded-md shadow-lg py-1 z-10 border"},[e("button",{onClick:x=>d(b,x),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," Preview PDF ",8,kt),e("button",{onClick:x=>m(b,x),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," Download PDF ",8,Dt),e("button",{onClick:x=>g(b,x),class:"block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 w-full text-left"}," Delete ",8,Vt)],512),[[ye,p(_)===b.id]])])])],10,It)}),128))])),F(_e,{"is-open":p(a),"pdf-url":p(o),title:"Invoice",onClose:l[0]||(l[0]=b=>a.value=!1),onDownload:p(s)},null,8,["is-open","pdf-url","onDownload"])],64))}}),Ct={class:"mb-6"},Ht={class:"space-y-4"},Rt=["onDragstart","onDragover","onDrop"],Ft={key:0,class:"absolute w-full h-1 bg-blue-500 -top-1 z-10 animate-pulse"},Lt={key:1,class:"absolute w-full h-1 bg-blue-500 -bottom-1 z-10 animate-pulse"},Et=["onClick"],Mt={class:"flex-1 flex items-center"},At=["d"],Nt=["d"],Ot={key:0},Bt={key:1,class:"text-gray-400"},Ut=["onClick"],qt={class:"p-4 border-t"},jt={class:"space-y-2"},zt={class:"grid grid-cols-1 gap-4"},Yt={class:"w-full"},Wt=["onUpdate:modelValue"],Xt={class:"grid gap-4",style:{"grid-template-columns":"repeat(auto-fit, minmax(200px, 1fr))"}},Gt=["onUpdate:modelValue","onInput"],Jt=["onUpdate:modelValue","onInput"],Zt={class:"mt-1"},Qt=M({__name:"InvoiceItemsList",props:{invoiceItems:{},draggedItem:{},dropTarget:{},dropPosition:{},isItemOpen:{}},emits:["drag-start","drag-over","drag-leave","drop","toggle-item","remove-item","update-amount","add-item"],setup(i,{emit:u}){const t=u;return(a,o)=>(c(),v("div",Ct,[o[7]||(o[7]=e("h3",{class:"text-lg font-semibold mb-3"},"Invoice Items",-1)),e("div",Ht,[F(Me,{name:"list",tag:"div",class:"space-y-4"},{default:Y(()=>[(c(!0),v(L,null,N(a.invoiceItems,(n,s)=>(c(),v("div",{key:s,class:E(["border rounded relative transition-all duration-200",{"opacity-50 scale-[0.98] rotate-1":a.draggedItem===s,"drop-target shadow-lg":a.dropTarget===s}]),draggable:"true",onDragstart:r=>t("drag-start",s),onDragover:r=>t("drag-over",r,s),onDragleave:o[1]||(o[1]=r=>t("drag-leave")),onDrop:r=>t("drop",s)},[a.dropTarget===s&&a.dropPosition==="before"?(c(),v("div",Ft)):H("",!0),a.dropTarget===s&&a.dropPosition==="after"?(c(),v("div",Lt)):H("",!0),e("div",{onClick:r=>t("toggle-item",s),class:"p-4 flex justify-between items-center cursor-pointer hover:bg-gray-50"},[e("div",Mt,[(c(),v("svg",{viewBox:"0 0 24 24",class:"w-5 h-5 mr-2 cursor-move text-gray-400 hover:text-gray-600",onClick:o[0]||(o[0]=le(()=>{},["stop"]))},[e("path",{d:p(at)},null,8,At)])),(c(),v("svg",{viewBox:"0 0 24 24",class:E(["w-5 h-5 mr-2 transition-transform duration-200",{"rotate-180":a.isItemOpen[s]}])},[e("path",{d:p(it)},null,8,Nt)],2)),n.description?(c(),v("span",Ot,T(n.description)+" - C$"+T(n.amount.toFixed(2)),1)):(c(),v("span",Bt," New Item "))]),e("button",{onClick:le(r=>t("remove-item",s),["stop"]),class:"text-red-600 text-sm hover:text-red-800"}," Remove ",8,Ut)],8,Et),B(e("div",qt,[e("div",jt,[e("div",zt,[e("div",Yt,[o[3]||(o[3]=e("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),B(e("input",{"onUpdate:modelValue":r=>n.description=r,type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,8,Wt),[[ee,n.description]])]),e("div",Xt,[e("div",null,[o[4]||(o[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Qty",-1)),B(e("input",{"onUpdate:modelValue":r=>n.qty=r,type:"number",onInput:r=>t("update-amount",s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,40,Gt),[[ee,n.qty,void 0,{number:!0}]])]),e("div",null,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium text-gray-700"},"Unit Price",-1)),B(e("input",{"onUpdate:modelValue":r=>n.unitPrice=r,type:"number",onInput:r=>t("update-amount",s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,40,Jt),[[ee,n.unitPrice,void 0,{number:!0}]])]),e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Amount",-1)),e("div",Zt,"C$"+T(n.amount.toFixed(2)),1)])])])])],512),[[ye,!n.description||a.isItemOpen[s]]])],42,Rt))),128))]),_:1})]),e("button",{onClick:o[2]||(o[2]=n=>t("add-item")),class:"mt-4 text-blue-600"}," + Add Item ")]))}}),Kt={class:"flex border-b"},eo={viewBox:"0 0 24 24",class:"w-5 h-5"},to=["d"],oo={viewBox:"0 0 24 24",class:"w-5 h-5"},so=["d"],no={class:"p-6"},io={key:0,class:"flex justify-center items-center py-12"},ao={key:1},ro={class:"mb-6"},lo=["value"],co={class:"mb-6"},uo={class:"space-y-2"},mo=["value"],vo={class:"border-t pt-4"},po={class:"text-right"},go={class:"text-lg font-semibold"},fo={key:2},bo=M({__name:"InvoicePanelLeft",props:{companyInfoText:{},programTitle:{},presetItems:{},invoiceItems:{},subtotal:{},isLoading:{type:Boolean},previousInvoices:{},selectedInvoice:{},activeTab:{},handleTabSwitch:{type:Function},addPresetItem:{type:Function},removeItem:{type:Function},updateAmount:{type:Function},handleInvoiceSelect:{type:Function},resetEditor:{type:Function}},emits:["update:companyInfoText","update:programTitle","update:invoiceItems","add-item","refresh-invoices"],setup(i,{emit:u}){const t=i,a=$({}),o=$(null),n=$(null),s=$(null),r=u,_=()=>{r("add-item",{description:"",qty:1,unitPrice:0,amount:0}),Ae(()=>{a.value[t.invoiceItems.length-1]=!0})},h=d=>{t.invoiceItems[d].description&&(a.value[d]=!a.value[d])},k=d=>{o.value=d},I=(d,m)=>{if(d.preventDefault(),o.value===null)return;const f=d.currentTarget.getBoundingClientRect(),l=f.top+f.height/2;n.value=m,s.value=d.clientY<l?"before":"after"},w=()=>{n.value=null,s.value=null},g=d=>{if(o.value===null)return;const m=[...t.invoiceItems],f=m[o.value];m.splice(o.value,1);const l=s.value==="after"?d+1:d;m.splice(l,0,f),r("update:invoiceItems",m),o.value=null,n.value=null,s.value=null};return(d,m)=>(c(),v(L,null,[e("div",Kt,[e("button",{onClick:m[0]||(m[0]=f=>d.handleTabSwitch("editor")),class:E(["px-6 py-3 font-medium flex items-center gap-2",t.activeTab==="editor"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"])},[(c(),v("svg",eo,[e("path",{d:p(we)},null,8,to)])),m[5]||(m[5]=U(" New Invoice "))],2),e("button",{onClick:m[1]||(m[1]=f=>d.handleTabSwitch("history")),class:E(["px-6 py-3 font-medium flex items-center gap-2",t.activeTab==="history"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"])},[(c(),v("svg",oo,[e("path",{d:p(rt)},null,8,so)])),m[6]||(m[6]=U(" Invoice History "))],2)]),e("div",no,[d.isLoading?(c(),v("div",io,m[7]||(m[7]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)]))):t.activeTab==="editor"?(c(),v("div",ao,[m[10]||(m[10]=e("h2",{class:"text-xl font-bold mb-6"},"Invoice Editor",-1)),e("div",ro,[m[8]||(m[8]=e("h3",{class:"text-lg font-semibold mb-3"},"Company Info",-1)),e("textarea",{value:d.companyInfoText,onInput:m[2]||(m[2]=f=>d.$emit("update:companyInfoText",f.target.value)),class:"w-full h-28 rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},"          ",40,lo)]),e("div",co,[m[9]||(m[9]=e("h3",{class:"text-lg font-semibold mb-3"},"Program Info",-1)),e("div",uo,[e("input",{value:d.programTitle,onInput:m[3]||(m[3]=f=>d.$emit("update:programTitle",f.target.value)),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm !bg-gray-100 text-sm p-2"},null,40,mo)])]),F(gt,{"preset-items":d.presetItems,onAddPresetItem:d.addPresetItem},null,8,["preset-items","onAddPresetItem"]),F(Qt,{"invoice-items":d.invoiceItems,"dragged-item":o.value,"drop-target":n.value,"drop-position":s.value,"is-item-open":a.value,onDragStart:k,onDragOver:I,onDragLeave:w,onDrop:g,onToggleItem:h,onRemoveItem:d.removeItem,onUpdateAmount:d.updateAmount,onAddItem:_},null,8,["invoice-items","dragged-item","drop-target","drop-position","is-item-open","onRemoveItem","onUpdateAmount"]),e("div",vo,[e("div",po,[e("div",go," Subtotal: C$"+T(d.subtotal.toFixed(2)),1)])])])):t.activeTab==="history"?(c(),v("div",fo,[F(St,{"previous-invoices":d.previousInvoices,"selected-invoice":d.selectedInvoice,onHandleInvoiceSelect:d.handleInvoiceSelect,onRefreshInvoices:m[4]||(m[4]=f=>d.$emit("refresh-invoices")),onResetEditor:d.resetEditor},null,8,["previous-invoices","selected-invoice","onHandleInvoiceSelect","onResetEditor"])])):H("",!0)])],64))}}),yo=Z(bo,[["__scopeId","data-v-cae66960"]]),ho={class:"preview-container p-8 bg-white shadow-lg"},Io=["src","alt"],_o={class:"w-full mb-8"},wo={class:"w-full"},$o={class:"text-right font-bold"},xo={class:"mb-6"},Po={class:"font-bold text-primary"},To={class:"w-full mb-8"},ko={class:"py-2"},Do={class:"text-right py-2"},Vo={class:"text-right py-2"},So={class:"text-right py-2"},Co={class:"w-1/2 ml-auto"},Ho={class:"flex justify-between border-b py-2"},Ro={class:"w-1/2 text-right"},Fo={class:"flex justify-between border-b py-2"},Lo={class:"w-1/2 text-right"},Eo={class:"flex justify-between border-b py-2"},Mo={class:"w-1/2 text-right"},Ao=["src","alt"],No={class:"text-center"},Oo=M({__name:"PreviewWindow",props:{student:{},subtotal:{},invoiceItems:{},companyInfo:{},programTitle:{},invoiceInfo:{}},setup(i){const u=i,t=W(()=>u.subtotal),a=o=>`C$${o.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`;return(o,n)=>(c(),v("div",ho,[e("img",{src:p(pe).src,alt:p(pe).alt,class:"w-1/2 mb-8"},null,8,Io),n[4]||(n[4]=e("div",{class:"text-center mb-12"},[e("h1",{class:"text-2xl font-bold text-primary text-right"},"INVOICE")],-1)),e("table",_o,[e("tbody",null,[e("tr",null,[e("td",null,[(c(!0),v(L,null,N(o.companyInfo,s=>(c(),v("p",{key:s.text,class:E({"font-bold":s.bold})},T(s.text),3))),128))]),e("td",null,[e("table",wo,[e("tbody",null,[(c(!0),v(L,null,N(o.invoiceInfo,(s,r)=>(c(),v("tr",{key:s.label},[e("td",$o,T(s.label),1),e("td",{class:E(["text-right",{italic:r===0}])},T(s.value),3)]))),128))])])])])])]),n[5]||(n[5]=e("div",{class:"h-16"},null,-1)),e("div",xo,[e("h3",Po,T(o.programTitle),1)]),n[6]||(n[6]=e("div",{class:"h-6"},null,-1)),e("table",To,[n[0]||(n[0]=e("thead",null,[e("tr",{class:"border-b"},[e("th",{class:"text-left py-2"},"Description"),e("th",{class:"text-right py-2"},"Qty"),e("th",{class:"text-right py-2 w-1/4"},"Unit Price"),e("th",{class:"text-right py-2 w-1/4"},"Amount")])],-1)),e("tbody",null,[(c(!0),v(L,null,N(o.invoiceItems,s=>(c(),v("tr",{key:s.description,class:"border-b"},[e("td",ko,T(s.description),1),e("td",Do,T(s.qty),1),e("td",Vo,T(a(s.unitPrice)),1),e("td",So,T(a(s.amount)),1)]))),128))])]),e("div",Co,[e("div",Ho,[n[1]||(n[1]=e("span",{class:"w-1/2 text-right font-bold"},"Subtotal:",-1)),e("span",Ro,T(a(t.value)),1)]),e("div",Fo,[n[2]||(n[2]=e("span",{class:"w-1/2 text-right font-bold"},"Total:",-1)),e("span",Lo,T(a(t.value)),1)]),e("div",Eo,[n[3]||(n[3]=e("span",{class:"w-1/2 text-right font-bold"},"Amount Paid:",-1)),e("span",Mo,T(a(t.value)),1)])]),n[7]||(n[7]=e("div",{class:"h-16"},null,-1)),e("img",{src:p(ge).src,alt:p(ge).alt,class:"w-14 mx-auto mt-8"},null,8,Ao),e("p",No,T(p(je)[0]),1)]))}}),fe=Z(Oo,[["__scopeId","data-v-c87568b7"]]),Bo={id:"rightSide",class:"bg-white p-6 rounded-lg shadow h-full"},Uo={key:0},qo={key:1,class:"flex items-center justify-center h-full"},jo={key:0},zo={key:1,class:"text-gray-500 italic bg-gray-100 p-4 rounded-lg"},Yo={key:2,class:"text-gray-500 italic bg-gray-100 p-4 rounded-lg"},Wo=M({__name:"InvoicePanelRight",props:{student:{},subtotal:{},invoiceItems:{},companyInfo:{},invoiceInfo:{},programTitle:{},activeTab:{},previousInvoices:{},selectedInvoice:{}},setup(i){const u=i;return he(()=>[u.invoiceItems,u.companyInfo,u.programTitle],()=>{}),(t,a)=>(c(),v("div",Bo,[t.activeTab==="editor"?(c(),v("div",Uo,[t.student?(c(),X(fe,{key:0,student:t.student,subtotal:t.subtotal,"invoice-items":t.invoiceItems,"company-info":t.companyInfo,"invoice-info":t.invoiceInfo,"program-title":t.programTitle},null,8,["student","subtotal","invoice-items","company-info","invoice-info","program-title"])):H("",!0)])):t.activeTab==="history"?(c(),v("div",qo,[t.selectedInvoice?(c(),v("div",jo,[t.student?(c(),X(fe,{key:0,student:t.student,subtotal:t.subtotal,"invoice-items":t.invoiceItems,"company-info":t.companyInfo,"invoice-info":t.invoiceInfo,"program-title":t.programTitle},null,8,["student","subtotal","invoice-items","company-info","invoice-info","program-title"])):H("",!0)])):t.previousInvoices.length===0?(c(),v("p",zo," No invoice history available ")):(c(),v("p",Yo," Select an invoice from history to preview "))])):H("",!0)]))}}),Xo=Z(Wo,[["__scopeId","data-v-88eb9408"]]),Go=[{description:"Registration Fee (Non-refundable)",qty:1,unitPrice:150,amount:150},{description:"Tuition Fee including Scholarship (Non-refundable)",qty:1,unitPrice:2850,amount:2850}],Jo=[{id:"invoice_number",label:"Invoice #:",getValue:({invoice:i})=>(i==null?void 0:i.invoice_number)||"Generated on Save"},{id:"bill_to",label:"Bill to:",getValue:({student:i})=>(i==null?void 0:i.display_name)||"N/A"},{id:"email",label:"Email:",getValue:({student:i})=>(i==null?void 0:i.user_email)||"N/A"},{id:"date_paid",label:"Date Paid:",getValue:({datePaid:i})=>i||"N/A"},{id:"payment_method",label:"Payment Method:",getValue:()=>"Agent",defaultValue:"Agent"}];function Zo(){const i=$(!1),u=$(!1),t=$(Ke),a=$(""),o=$([]),n=$(Go),s=$([]),r=$(null),_=W(()=>o.value.reduce((l,b)=>l+b.amount,0)),h=W({get:()=>t.value.map(l=>l.text).join(`
`),set:l=>{t.value=l.split(`
`).map(b=>({text:b,bold:!1}))}});return{isLoading:i,showPdfModal:u,invoiceItems:o,companyInfo:t,programTitle:a,presetItems:n,previousInvoices:s,selectedInvoice:r,companyInfoText:h,subtotal:_,setProgramTitle:l=>{const b=ze.find(V=>V.id===l);b?a.value=`${b.title}`:a.value=`${l}`},addPresetItem:l=>{o.value.push({...l})},addNewItem:()=>{o.value.push({description:"",qty:1,unitPrice:0,amount:0})},removeItem:l=>{o.value.splice(l,1)},updateAmount:l=>{const b=o.value[l];b.amount=b.qty*b.unitPrice},handleSave:async l=>{if(!(l!=null&&l.ID)){R.error("Student ID is required");return}if(!(l!=null&&l.enrollment_date)){R.error("Enrolment date is required");return}if(o.value.length===0){R.error("Please add at least one invoice item");return}if(t.value.length===0||t.value.every(V=>!V.text.trim())){R.error("Company information cannot be empty");return}if(!a.value.trim()){R.error("Program title cannot be empty");return}if(o.value.some(V=>!V.description.trim()||V.qty<=0||V.unitPrice<=0)){R.error("All invoice items must have a description, quantity, and price greater than 0");return}try{const V={student_id:l.ID,program_title:a.value,company_info:JSON.stringify(t.value),invoice_info:JSON.stringify([]),invoice_items:JSON.stringify(o.value),enrolment_date:l.enrollment_date};await Xe(V),R.success("Invoice saved successfully")}catch(V){console.error("Failed to save invoice:",V),R.error("Failed to save invoice")}},resetEditor:()=>{r.value=null,o.value=[]}}}const Qo={key:0,class:"flex flex-col"},Ko={key:1,class:"flex flex-col"},es={class:"mb-6 flex justify-between items-center"},ts={class:"space-x-4 flex items-center"},os={class:"flex flex-row"},ss={id:"leftSide",class:"bg-white rounded-lg shadow",style:{width:"50%"}},ns={viewBox:"0 0 24 24",class:"icon"},is=["d"],as={id:"rightSide",class:"bg-white rounded-lg shadow",style:{width:"calc(50% - 10px)"}},rs=M({__name:"InvoiceEditor",async setup(i){let u,t;const a=Oe(),o=Be(),{getStudentById:n}=Ge(),{student:s,pdfUrl:r,pdfTitle:_}=Ye(),{isLoading:h,showPdfModal:k,invoiceItems:I,companyInfo:w,programTitle:g,presetItems:d,previousInvoices:m,selectedInvoice:f,companyInfoText:l,subtotal:b,setProgramTitle:V,addPresetItem:x,addNewItem:O,removeItem:xe,updateAmount:Pe,handleSave:Te,resetEditor:ne}=Zo(),C=$(([u,t]=Ne(()=>n(parseInt(a.params.id,10))),u=await u,t(),u));s.value=C.value;const ke=parseInt(a.query.course_id,10),De=$(a.query.mode),ie=W(()=>Jo.map(D=>{var y;return{label:D.label,value:D.getValue({invoice:f.value,student:C.value,datePaid:Qe(((y=C.value)==null?void 0:y.enrollment_date)||"")})}})),q=$({invoiceItems:[],companyInfo:w.value,programTitle:g.value}),A=$(De.value),Q=async()=>{var D;if(C.value){const y=await $e({invoiceData:I.value,programTitle:g.value,companyInfo:w.value,invoiceInfo:ie.value,enrolmentDate:C.value.enrollment_date,invoiceNumber:((D=f.value)==null?void 0:D.invoice_number)||""});_.value="Invoice",r.value=URL.createObjectURL(y)}},K=async()=>{var D;if((D=C.value)!=null&&D.ID)try{h.value=!0;const y=await Je(C.value.ID);m.value=y.map(P=>({...P,updated_at:P.created_at,invoice_items:Array.isArray(P.invoice_items)?P.invoice_items:JSON.parse(P.invoice_items),company_info:Array.isArray(P.company_info)?P.company_info:JSON.parse(P.company_info),invoice_info:Array.isArray(P.invoice_info)?P.invoice_info:JSON.parse(P.invoice_info)}))}catch(y){console.error("Failed to fetch previous invoices:",y)}finally{h.value=!1}},Ve=async D=>{try{h.value=!0,f.value=D,w.value=D.company_info,I.value=D.invoice_items,g.value=D.program_title,await Q()}catch(y){console.error("Failed to load invoice:",y)}finally{h.value=!1}},Se=D=>{D==="editor"?(ne(),A.value="editor",I.value=q.value.invoiceItems,w.value=q.value.companyInfo,g.value=q.value.programTitle):(A.value="history",q.value={invoiceItems:[...I.value],companyInfo:[...w.value],programTitle:g.value},I.value=[],K()),o.replace({query:{...a.query,mode:D}})},Ce=async()=>{k.value=!0},He=D=>{const y=document.getElementById("leftSide"),P=document.getElementById("rightSide"),Re=D.clientX,Fe=y.offsetWidth,ae=Le=>{const j=Fe+(Le.clientX-Re);j>100&&j<window.innerWidth-100&&(y.style.width=`${j}px`,P.style.width=`calc(100% - ${j}px - 10px)`)},re=()=>{document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",re)};document.addEventListener("mousemove",ae),document.addEventListener("mouseup",re)};return he([I,C,g,b],Q,{deep:!0}),be(()=>{V(ke),Q(),K()}),(D,y)=>(c(),v(L,null,[C.value?H("",!0):(c(),v("div",Qo," Loading... ")),C.value?(c(),v("div",Ko,[e("div",es,[F(oe,{showIcon:"return",iconPosition:"left",onClick:y[0]||(y[0]=P=>p(o).back()),buttonClass:"bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow flex items-center transition duration-300 ease-in-out"},{default:Y(()=>y[6]||(y[6]=[U(" Return ")])),_:1}),e("div",ts,[A.value==="editor"?(c(),X(oe,{key:0,showIcon:"magnify",onClick:Ce,buttonClass:"bg-blue-100 hover:bg-blue-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow flex items-center transition duration-300 ease-in-out"},{default:Y(()=>y[7]||(y[7]=[U(" Preview PDF ")])),_:1})):H("",!0),A.value==="editor"?(c(),X(oe,{key:1,showIcon:"save",onClick:y[1]||(y[1]=()=>p(Te)(C.value)),buttonClass:"bg-green-100 hover:bg-green-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow flex items-center transition duration-300 ease-in-out"},{default:Y(()=>y[8]||(y[8]=[U(" Save ")])),_:1})):H("",!0)])]),e("div",os,[e("div",ss,[F(yo,{"company-info-text":p(l),"onUpdate:companyInfoText":y[2]||(y[2]=P=>te(l)?l.value=P:null),"program-title":p(g),"onUpdate:programTitle":y[3]||(y[3]=P=>te(g)?g.value=P:null),"invoice-items":p(I),"onUpdate:invoiceItems":y[4]||(y[4]=P=>te(I)?I.value=P:null),"preset-items":p(d),subtotal:p(b),"is-loading":p(h),"previous-invoices":p(m),"selected-invoice":p(f),"active-tab":A.value,"handle-tab-switch":Se,"add-preset-item":p(x),"remove-item":p(xe),"update-amount":p(Pe),"handle-invoice-select":Ve,"reset-editor":p(ne),onAddItem:p(O),onRefreshInvoices:K},null,8,["company-info-text","program-title","invoice-items","preset-items","subtotal","is-loading","previous-invoices","selected-invoice","active-tab","add-preset-item","remove-item","update-amount","reset-editor","onAddItem"])]),e("div",{class:"resize-handler flex items-center justify-center",onMousedown:He},[(c(),v("svg",ns,[e("path",{d:p(nt)},null,8,is)]))],32),e("div",as,[F(Xo,{student:C.value,subtotal:p(b),"invoice-items":p(I),"company-info":p(w),"invoice-info":ie.value,"program-title":p(g),"active-tab":A.value,"previous-invoices":p(m),"selected-invoice":p(f)},null,8,["student","subtotal","invoice-items","company-info","invoice-info","program-title","active-tab","previous-invoices","selected-invoice"])])]),F(_e,{"is-open":p(k),"pdf-url":p(r),title:"Invoice",onClose:y[5]||(y[5]=P=>k.value=!1)},null,8,["is-open","pdf-url"])])):H("",!0)],64))}}),gs=Z(rs,[["__scopeId","data-v-0f06bbe9"]]);export{gs as default};
